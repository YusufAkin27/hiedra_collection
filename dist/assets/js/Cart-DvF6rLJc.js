import{u as e,r as s,j as a,L as t}from"./react-vendor-2SZXphvN.js";import{u as i,a as c}from"./context-Fvoum6Gs.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const r="http://localhost:8080/api",n=()=>{const{cartItems:n,removeFromCart:l,updateQuantity:o,clearCart:d,getCartTotal:m,getCartSubtotal:u,refreshCart:h,discountAmount:p,couponCode:x,setDiscountAmount:j,setCouponCode:y}=i(),{accessToken:v,isAuthenticated:g}=c(),N=e(),[k,b]=s.useState(""),[f,C]=s.useState(!1),[w,z]=s.useState(!1),[K,S]=s.useState(""),[I,B]=s.useState("");s.useEffect(()=>{h()},[]);const U=async()=>{if(k.trim())if(g)try{C(!0),S(""),B("");let e=null;g&&v||(e=localStorage.getItem("guestUserId"));const s=`${r}/cart/apply-coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",...v&&{Authorization:"Bearer "+v}},body:JSON.stringify({couponCode:k.trim().toUpperCase()})}),t=await a.json();a.ok&&(t.isSuccess||t.success)?(B("Kupon başarıyla uygulandı!"),b(""),await h()):S(t.message||"Kupon uygulanamadı")}catch(e){S("Kupon uygulanırken bir hata oluştu")}finally{C(!1)}else S("Kupon uygulamak için lütfen giriş yapınız");else S("Lütfen kupon kodunu giriniz")},A=async()=>{try{z(!0),S(""),B("");let e=null;g&&v||(e=localStorage.getItem("guestUserId"));const s=`${r}/cart/coupon${e?"?guestUserId="+e:""}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...v&&{Authorization:"Bearer "+v}}}),t=await a.json();a.ok&&(t.isSuccess||t.success)?(B("Kupon kaldırıldı"),y(null),j(0),await h()):S(t.message||"Kupon kaldırılamadı")}catch(e){S("Kupon kaldırılırken bir hata oluştu")}finally{z(!1)}},T=async(e,s=null,a=null)=>{try{if(a&&s&&s.startsWith("backend_")){let e=null;g&&v||(e=localStorage.getItem("guestUserId"));const s=`${r}/cart/items/${a}${e?"?guestUserId="+e:""}`;if((await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",...v&&{Authorization:"Bearer "+v}}})).ok)return void(await h())}l(e,s)}catch(t){l(e,s)}},$=async(e,s,a=null,t=null)=>{if(s>0)try{if(t&&a&&a.startsWith("backend_")){let e=null;g&&v||(e=localStorage.getItem("guestUserId"));const a=`${r}/cart/items/${t}${e?"?guestUserId="+e:""}`;if((await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",...v&&{Authorization:"Bearer "+v}},body:JSON.stringify({quantity:s})})).ok)return void(await h())}o(e,s,a)}catch(i){o(e,s,a)}else T(e,a,t)},E=(e,s=40)=>e.length>s?e.substring(0,s)+"...":e;return 0===n.length?a.jsx("div",{className:"cart-page",children:a.jsxs("div",{className:"cart-empty",children:[a.jsx("div",{className:"cart-empty-icon",children:a.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"}),a.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),a.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"})]})}),a.jsx("h2",{children:"Sepetiniz Boş"}),a.jsx("p",{children:"Alışverişe başlamak için ürünlerimizi inceleyin"}),a.jsx(t,{to:"/",className:"cart-empty-btn",children:"Alışverişe Başla"})]})}):a.jsx("div",{className:"cart-page",children:a.jsxs("div",{className:"cart-wrapper",children:[a.jsxs("div",{className:"cart-header",children:[a.jsx("h1",{children:"Sepetim"}),a.jsxs("span",{className:"cart-count",children:[n.length," ürün"]})]}),a.jsxs("div",{className:"cart-main",children:[a.jsxs("div",{className:"cart-left-column",children:[a.jsx("div",{className:"cart-items-wrapper",children:a.jsx("div",{className:"cart-items-list",children:n.map((e,s)=>a.jsxs("div",{className:"cart-item-card",children:[a.jsx(t,{to:"/product/"+e.id,className:"cart-item-image-link",children:a.jsx("div",{className:"cart-item-image",children:a.jsx("img",{src:e.image,alt:e.name})})}),a.jsxs("div",{className:"cart-item-info",children:[a.jsx(t,{to:"/product/"+e.id,className:"cart-item-name",children:E(e.name,60)}),e.customizations&&a.jsxs("div",{className:"cart-item-specs",children:[a.jsxs("span",{children:["En: ",e.customizations.en," cm"]}),a.jsxs("span",{children:["Boy: ",e.customizations.boy," cm"]}),a.jsxs("span",{children:["Pile: ","pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi]})]}),a.jsxs("div",{className:"cart-item-bottom",children:[a.jsxs("div",{className:"cart-item-quantity",children:[a.jsx("button",{className:"cart-qty-btn",onClick:()=>$(e.id,e.quantity-1,e.itemKey,e.cartItemId),"aria-label":"Azalt",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),a.jsx("span",{className:"cart-qty-value",children:e.quantity}),a.jsx("button",{className:"cart-qty-btn",onClick:()=>$(e.id,e.quantity+1,e.itemKey,e.cartItemId),"aria-label":"Artır",children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]}),a.jsxs("div",{className:"cart-item-price",children:[e.subtotal?e.subtotal.toFixed(2):((e.customizations?.calculatedPrice||e.price)*e.quantity).toFixed(2)," ₺"]})]})]}),a.jsx("button",{className:"cart-item-remove",onClick:()=>T(e.id,e.itemKey,e.cartItemId),"aria-label":"Kaldır",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},e.itemKey||`${e.id}_${s}`))})}),a.jsxs("div",{className:"cart-coupon-section cart-coupon-mobile",children:[x?a.jsxs("div",{className:"cart-coupon-applied",children:[a.jsx("span",{className:"cart-coupon-code-text",children:x}),a.jsxs("span",{className:"cart-coupon-discount-text",children:["-",p.toFixed(2)," ₺"]}),a.jsx("button",{className:"cart-coupon-remove-btn",onClick:A,disabled:w,children:w?"...":"Kaldır"})]}):a.jsxs("div",{className:"cart-coupon-input-wrapper",children:[a.jsx("input",{type:"text",placeholder:"İndirim Kodu Giriniz",value:k,onChange:e=>{b(e.target.value.toUpperCase()),S(""),B("")},onKeyPress:e=>{"Enter"===e.key&&U()},className:"cart-coupon-input-simple",disabled:f||!g}),a.jsx("button",{className:"cart-coupon-apply-btn",onClick:U,disabled:f||!g||!k.trim(),children:f?"...":"Uygula"})]}),K&&a.jsx("div",{className:"cart-coupon-message-error",children:K}),I&&a.jsx("div",{className:"cart-coupon-message-success",children:I})]})]}),a.jsx("div",{className:"cart-right-column",children:a.jsxs("div",{className:"cart-summary-card",children:[a.jsx("h3",{className:"cart-summary-title",children:"Sipariş Özeti"}),a.jsxs("div",{className:"cart-coupon-section cart-coupon-desktop",children:[x?a.jsxs("div",{className:"cart-coupon-applied",children:[a.jsx("span",{className:"cart-coupon-code-text",children:x}),a.jsxs("span",{className:"cart-coupon-discount-text",children:["-",p.toFixed(2)," ₺"]}),a.jsx("button",{className:"cart-coupon-remove-btn",onClick:A,disabled:w,children:w?"...":"Kaldır"})]}):a.jsxs("div",{className:"cart-coupon-input-wrapper",children:[a.jsx("input",{type:"text",placeholder:"İndirim Kodu Giriniz",value:k,onChange:e=>{b(e.target.value.toUpperCase()),S(""),B("")},onKeyPress:e=>{"Enter"===e.key&&U()},className:"cart-coupon-input-simple",disabled:f||!g}),a.jsx("button",{className:"cart-coupon-apply-btn",onClick:U,disabled:f||!g||!k.trim(),children:f?"...":"Uygula"})]}),K&&a.jsx("div",{className:"cart-coupon-message-error",children:K}),I&&a.jsx("div",{className:"cart-coupon-message-success",children:I})]}),a.jsxs("div",{className:"cart-summary-details",children:[a.jsxs("div",{className:"cart-summary-row",children:[a.jsx("span",{children:"Ara Toplam"}),a.jsxs("span",{children:[u().toFixed(2)," ₺"]})]}),p>0&&a.jsxs("div",{className:"cart-summary-row cart-summary-discount",children:[a.jsxs("span",{children:["İndirim (",x,")"]}),a.jsxs("span",{children:["-",p.toFixed(2)," ₺"]})]}),a.jsxs("div",{className:"cart-summary-row",children:[a.jsx("span",{children:"Kargo"}),a.jsx("span",{className:"cart-shipping-free",children:"Ücretsiz"})]})]}),a.jsxs("div",{className:"cart-summary-total",children:[a.jsx("span",{children:"Toplam"}),a.jsxs("span",{children:[m().toFixed(2)," ₺"]})]}),a.jsxs("button",{className:"cart-checkout-btn",onClick:()=>N("/checkout"),children:["Sepeti Onayla",a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),a.jsx("polyline",{points:"12 5 19 12 12 19"})]})]}),a.jsx(t,{to:"/",className:"cart-continue-link",children:"Alışverişe Devam Et"})]})}),a.jsxs("div",{className:"cart-bottom-bar",children:[a.jsxs("div",{className:"cart-total-info",children:[a.jsxs("div",{className:"cart-total-amount",children:[m().toFixed(2)," ₺"]}),a.jsx("div",{className:"cart-shipping-text",children:p>0?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"cart-shipping-free",children:"Kargo Bedava"}),a.jsxs("span",{className:"cart-discount-badge",children:["Kupon İndirimi: ",a.jsxs("strong",{children:[p.toFixed(2)," ₺"]})]})]}):a.jsx("span",{className:"cart-shipping-free",children:"Kargo Bedava"})})]}),a.jsxs("button",{className:"cart-confirm-btn",onClick:()=>N("/checkout"),children:["Sepeti Onayla",a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),a.jsx("polyline",{points:"12 5 19 12 12 19"})]})]})]})]})]})})};export{n as default};
