import{u as e,r as i,j as a,L as s}from"./react-vendor-2SZXphvN.js";import{a as l,b as t}from"./context-Fvoum6Gs.js";import{S as n}from"./SEO-CLq8vwqd.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const o=()=>{const o=e(),{requestCode:r,verifyCode:d,isAuthenticated:c,setUser:u,setAccessToken:h,saveAuthToStorage:m,accessToken:g}=l(),{theme:p}=t();i.useEffect(()=>{c&&g&&x()},[c,g]);const x=async(e=g)=>{if(e)try{const i=await fetch("http://localhost:8080/api/user/profile",{headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}});if(i.ok){const e=await i.json();if(e.success&&e.data){const i=e.data;i.fullName&&i.phone&&""!==i.fullName.trim()&&""!==i.phone.trim()?o("/"):o("/profil")}else o("/")}else o("/")}catch(i){o("/")}else o("/")},[j,v]=i.useState(""),[k,f]=i.useState(""),[b,y]=i.useState("email"),[N,w]=i.useState(!1),[z,G]=i.useState(""),[C,S]=i.useState(""),[E,T]=i.useState(0),[L,M]=i.useState(!1);return i.useEffect(()=>{if(E>0){const e=setTimeout(()=>{T(E-1)},1e3);return()=>clearTimeout(e)}0===E&&"code"===b&&M(!0)},[E,b]),a.jsxs(a.Fragment,{children:[a.jsx(n,{title:"Giriş Yap - Hiedra Collection",description:"Hiedra Collection'a giriş yapın. E-posta doğrulama kodu ile güvenli giriş."}),a.jsx("div",{className:"login-page",children:a.jsx("div",{className:"login-page-container",children:a.jsxs("div",{className:"login-page-content","data-theme":p,children:[a.jsxs("div",{className:"login-security-badge",children:[a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),a.jsx("path",{d:"M9 12l2 2 4-4"})]}),a.jsx("span",{children:"Güvenli Giriş"})]}),a.jsx("h2",{className:"login-title",children:"email"===b?"Hoş Geldiniz":"Doğrulama Kodu"}),a.jsx("p",{className:"login-subtitle",children:"email"===b?"Hesabınıza güvenli bir şekilde giriş yapın. E-posta adresinize gönderilecek doğrulama kodu ile kimliğiniz doğrulanacaktır.":j+" adresine gönderilen 6 haneli güvenlik kodunu girin"}),z&&a.jsx("div",{className:"login-error",children:z}),C&&a.jsx("div",{className:"login-success",children:C}),"email"===b?a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),G(""),S(""),w(!0),!j)return G("Lütfen e-posta adresinizi girin"),void w(!1);const i=await r(j);w(!1),i.success?(S("Doğrulama kodu e-posta adresinize gönderildi"),y("code"),T(180),M(!1)):G(i.error||"Kod gönderilemedi")},className:"login-form",children:[a.jsxs("div",{className:"login-form-group",children:[a.jsx("label",{htmlFor:"email",className:"login-label",children:"E-posta Adresi"}),a.jsx("input",{id:"email",type:"email",className:"login-input",placeholder:"E-posta adresinizi girin",value:j,onChange:e=>v(e.target.value),required:!0,autoComplete:"email",disabled:N})]}),a.jsx("button",{type:"submit",className:"login-submit",disabled:N,children:N?"Kod gönderiliyor...":"Doğrulama Kodu Gönder"})]}),a.jsx("div",{className:"login-divider",children:a.jsx("span",{children:"veya"})}),a.jsxs("button",{type:"button",className:"login-google-button",onClick:async()=>{G(""),S(""),w(!0);try{const e="http://localhost:8080/api",i=e+"/auth/oauth2/authorization/google",a=500,s=600,l=window.screen.width/2-a/2,t=window.screen.height/2-s/2,n=window.open(i,"Google Login",`width=${a},height=${s},left=${l},top=${t},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`);if(!n)return G("Popup engellendi. Lütfen popup engelleyiciyi kapatın ve tekrar deneyin."),void w(!1);const o=i=>{const a=new URL(e).origin;if(i.origin===a||i.origin===window.location.origin)if(i.data&&"GOOGLE_AUTH_SUCCESS"===i.data.type){const e=i.data.authData;u(e.user),h(e.accessToken),m({user:e.user,accessToken:e.accessToken}),S("Google ile giriş başarılı! Yönlendiriliyorsunuz..."),n&&!n.closed&&n.close(),setTimeout(async()=>{await x(e.accessToken)},1500)}else i.data&&"GOOGLE_AUTH_ERROR"===i.data.type&&(G(i.data.error||"Google ile giriş başarısız"),n&&!n.closed&&n.close(),w(!1))};let r=!1;const d=e=>{o(e),!e.data||"GOOGLE_AUTH_SUCCESS"!==e.data.type&&"GOOGLE_AUTH_ERROR"!==e.data.type||(r=!0)};window.addEventListener("message",d);const c=setInterval(()=>{n.closed&&(clearInterval(c),window.removeEventListener("message",d),r||(G("Google giriş işlemi iptal edildi"),w(!1)))},1e3)}catch(e){G("Google ile giriş yapılırken bir hata oluştu"),w(!1)}},disabled:N,children:[a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[a.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),a.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),a.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),a.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google ile Giriş Yap"]}),"email"===b&&a.jsxs("div",{className:"login-security-features",children:[a.jsxs("div",{className:"security-feature-item",children:[a.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}),a.jsx("span",{children:"SSL Şifreli Bağlantı"})]}),a.jsxs("div",{className:"security-feature-item",children:[a.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})}),a.jsx("span",{children:"Doğrulanmış Satıcı"})]}),a.jsxs("div",{className:"security-feature-item",children:[a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"})]}),a.jsx("span",{children:"Kişisel Verileriniz Korunur"})]})]})]}):a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),G(""),S(""),w(!0),!k||6!==k.length)return G("Lütfen 6 haneli doğrulama kodunu girin"),void w(!1);const i=await d(j,k);w(!1),i.success?(S("Giriş başarılı! Yönlendiriliyorsunuz..."),setTimeout(async()=>{await x()},1500)):G(i.error||"Doğrulama kodu geçersiz")},className:"login-form",children:[a.jsxs("div",{className:"login-form-group",children:[a.jsx("label",{htmlFor:"code",className:"login-label",children:"Doğrulama Kodu"}),a.jsx("input",{id:"code",type:"text",className:"login-input login-code-input",placeholder:"000000",value:k,onChange:e=>{const i=e.target.value.replace(/\D/g,"").slice(0,6);f(i)},required:!0,maxLength:6,autoComplete:"off",inputMode:"numeric",pattern:"[0-9]*",disabled:N}),a.jsx("p",{className:"login-code-hint",children:"6 haneli doğrulama kodunu girin"})]}),a.jsx("button",{type:"submit",className:"login-submit",disabled:N||6!==k.length,children:N?"Doğrulanıyor...":"Giriş Yap"}),a.jsxs("div",{className:"login-resend-section",children:[a.jsx("button",{type:"button",className:"login-resend-button",onClick:async()=>{if(!L||E>0)return;G(""),S(""),w(!0);const e=await r(j);w(!1),e.success?(S("Yeni doğrulama kodu gönderildi"),T(180),M(!1)):G(e.error||"Kod gönderilemedi")},disabled:!L||N||E>0,children:E>0?`Yeniden gönder (${H=E,`${Math.floor(H/60)}:${(""+H%60).padStart(2,"0")}`})`:"Yeniden Kod Gönder"}),a.jsx("button",{type:"button",className:"login-back-button",onClick:()=>{y("email"),f(""),G(""),S(""),T(0),M(!1)},disabled:N,children:"E-posta değiştir"})]})]}),a.jsxs("div",{className:"login-footer",children:[a.jsx("p",{className:"login-footer-text",children:"Hesabınız yok mu? Otomatik olarak oluşturulacaktır."}),a.jsx("div",{className:"login-agreement-notice",children:a.jsxs("p",{className:"agreement-notice-text",children:["Kişisel verileriniz, ",a.jsx(s,{to:"/kvkk",target:"_blank",children:a.jsx("strong",{children:"Aydınlatma Metni"})}),' kapsamında işlenmektedir. "Doğrulama Kodu Gönder" butonuna basarak ',a.jsx(s,{to:"/kullanim-kosullari",target:"_blank",children:a.jsx("strong",{children:"Üyelik Sözleşmesi"})}),"'ni ve ",a.jsx(s,{to:"/gizlilik-politikasi",target:"_blank",children:a.jsx("strong",{children:"Gizlilik Politikası"})}),"'nı okuduğunuzu ve kabul ettiğinizi onaylıyorsunuz."]})})]})]})})})]});var H};export{o as default};
