import{u as e,r as s,j as a,L as d}from"./react-vendor-2SZXphvN.js";import{a as i}from"./context-Fvoum6Gs.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const n="http://localhost:8080/api",l=()=>{const{isAuthenticated:l,accessToken:r}=i(),t=e(),[c,o]=s.useState([]),[h,m]=s.useState(!0),[u,x]=s.useState(""),[p,j]=s.useState(""),[N,y]=s.useState(null),[v,f]=s.useState({isOpen:!1,addressId:null,addressName:""}),[k,b]=s.useState({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",isDefault:!1});s.useEffect(()=>{l||t("/giris",{state:{from:"/adreslerim"}})},[l,t]),s.useEffect(()=>{l&&r&&g()},[l,r]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&v.isOpen&&A()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[v.isOpen]);const g=async()=>{try{m(!0),x("");const e=await fetch(n+"/user/addresses",{headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"}}),s=await e.json();e.ok&&(s.isSuccess||s.success)?o(s.data||[]):x(s.message||"Adresler yüklenemedi")}catch(e){x("Adresler yüklenirken bir hata oluştu")}finally{m(!1)}},w=e=>{const{name:s,value:a,type:d,checked:i}=e.target;b(e=>({...e,[s]:"checkbox"===d?i:a}))},D=async e=>{e.preventDefault(),x(""),j("");try{const e=N?`${n}/user/addresses/${N.id}`:n+"/user/addresses",s=N?"PUT":"POST",a=await fetch(e,{method:s,headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"},body:JSON.stringify({...k})}),d=await a.json();a.ok&&(d.isSuccess||d.success)?(j(N?"Adres güncellendi":"Adres eklendi"),y(null),C(),g(),setTimeout(()=>j(""),3e3)):x(d.message||"İşlem başarısız")}catch(s){x("Adres kaydedilirken bir hata oluştu")}},A=()=>{f({isOpen:!1,addressId:null,addressName:""})},C=()=>{b({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:"",isDefault:!1})},S=()=>{y(null),C()};return l?h?a.jsx("div",{className:"addresses-container",children:a.jsxs("div",{className:"loading-state",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Adresler yükleniyor..."})]})}):a.jsxs("div",{className:"addresses-container",children:[a.jsxs("div",{className:"addresses-header",children:[a.jsx("h1",{children:"Adreslerim"}),a.jsxs("div",{className:"header-actions",children:[c.length>0&&a.jsxs("span",{className:"address-count",children:[c.length," / 10 adres"]}),a.jsx(d,{to:"/adres-ekle",className:"btn-add-address "+(10>c.length?"":"disabled"),onClick:e=>{if(c.length>=10)return e.preventDefault(),void x("Maksimum 10 adet adres ekleyebilirsiniz. Lütfen mevcut adreslerinizden birini silin.")},style:{textDecoration:"none",display:"inline-block"},children:"+ Yeni Adres Ekle"})]})]}),u&&a.jsx("div",{className:"alert alert-error",children:u}),p&&a.jsx("div",{className:"alert alert-success",children:p}),0===c.length?a.jsxs("div",{className:"no-addresses",children:[a.jsx("p",{children:"Henüz adres eklenmemiş."}),a.jsx(d,{to:"/adres-ekle",className:"btn-add-address",style:{textDecoration:"none",display:"inline-block"},children:"İlk Adresinizi Ekleyin"})]}):10>c.length?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"addresses-list",children:c.map(e=>{const s=N&&N.id===e.id;return a.jsx("div",{className:`address-card ${e.isDefault?"default":""} ${s?"address-card-editing":""}`,children:a.jsxs("form",{onSubmit:s?D:e=>e.preventDefault(),className:s?"address-form-inline":"",children:[a.jsx("div",{className:"address-card-header",children:a.jsx("div",{className:"address-card-title",children:s?a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"text",name:"fullName",value:k.fullName,onChange:w,className:"address-input-inline",placeholder:"Ad Soyad",required:!0}),a.jsx("input",{type:"tel",name:"phone",value:k.phone,onChange:w,className:"address-input-inline address-input-phone",placeholder:"Telefon",required:!0})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"address-name-row",children:[a.jsx("h3",{children:e.fullName}),e.isDefault&&a.jsxs("div",{className:"default-badge",children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),a.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"Varsayılan Adres"]})]}),a.jsxs("p",{className:"address-phone",children:[a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),e.phone]})]})})}),a.jsxs("div",{className:"address-info",children:[a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Adres:"}),s?a.jsx("input",{type:"text",name:"addressLine",value:k.addressLine,onChange:w,className:"address-input-inline",required:!0}):a.jsx("span",{className:"address-value",children:e.addressLine})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Adres Detayı:"}),s?a.jsx("input",{type:"text",name:"addressDetail",value:k.addressDetail,onChange:w,className:"address-input-inline",placeholder:"Daire, Kat vb."}):a.jsx("span",{className:"address-value",children:e.addressDetail||"-"})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"Şehir:"}),s?a.jsx("input",{type:"text",name:"city",value:k.city,onChange:w,className:"address-input-inline",required:!0,style:{width:"100%",padding:"0.5rem"}}):a.jsx("span",{className:"address-value",children:e.city})]}),a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label",children:"İlçe:"}),s?a.jsx("input",{type:"text",name:"district",value:k.district,onChange:w,className:"address-input-inline",required:!0,style:{width:"100%",padding:"0.5rem"}}):a.jsx("span",{className:"address-value",children:e.district})]}),s&&a.jsxs("div",{className:"address-detail-row",children:[a.jsx("span",{className:"address-label"}),a.jsxs("label",{className:"checkbox-inline",children:[a.jsx("input",{type:"checkbox",name:"isDefault",checked:k.isDefault,onChange:w}),a.jsx("span",{children:"Varsayılan adres olarak ayarla"})]})]})]}),a.jsx("div",{className:"address-actions",children:s?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:"btn-cancel",onClick:S,children:"İptal"}),a.jsx("button",{type:"submit",className:"btn-submit",children:"Güncelle"})]}):a.jsxs(a.Fragment,{children:[!e.isDefault&&a.jsx("button",{type:"button",className:"btn-set-default",onClick:()=>(async e=>{try{x("");const s=c.find(s=>s.id===e);if(!s)return;const a=await fetch(`${n}/user/addresses/${e}`,{method:"PUT",headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"},body:JSON.stringify({...s,isDefault:!0})}),d=await a.json();a.ok&&(d.isSuccess||d.success)?(j("Varsayılan adres güncellendi"),g(),setTimeout(()=>j(""),3e3)):x(d.message||"Varsayılan adres güncellenemedi")}catch(s){x("Varsayılan adres güncellenirken bir hata oluştu")}})(e.id),children:"Varsayılan Yap"}),a.jsx("button",{type:"button",className:"btn-edit",onClick:s=>{s.preventDefault(),s.stopPropagation(),(e=>{y(e),b({fullName:e.fullName||"",phone:e.phone||"",addressLine:e.addressLine||"",addressDetail:e.addressDetail||"",city:e.city||"",district:e.district||"",isDefault:e.isDefault||!1})})(e)},children:"Düzenle"}),a.jsx("button",{type:"button",className:"btn-delete",onClick:()=>{return s=e.id,a=e.fullName,void f({isOpen:!0,addressId:s,addressName:a||"Bu adres"});var s,a},children:"Sil"})]})})]})},e.id)})}),10>c.length&&a.jsx("div",{className:"add-address-footer",children:a.jsx(d,{to:"/adres-ekle",className:"btn-add-address btn-add-address-footer",style:{textDecoration:"none",display:"inline-block"},children:"+ Yeni Adres Ekle"})})]}):a.jsx("div",{className:"max-addresses-warning",children:a.jsx("p",{children:"Maksimum adres sayısına ulaştınız (10 adet). Yeni adres eklemek için mevcut adreslerinizden birini silin."})}),v.isOpen&&a.jsx("div",{className:"delete-modal-overlay",onClick:A,children:a.jsxs("div",{className:"delete-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"delete-modal-header",children:[a.jsx("h3",{children:"Adresi Sil"}),a.jsx("button",{className:"delete-modal-close",onClick:A,"aria-label":"Kapat",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),a.jsxs("div",{className:"delete-modal-body",children:[a.jsx("div",{className:"delete-modal-icon",children:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M3 6h18"}),a.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),a.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),a.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}),a.jsxs("p",{className:"delete-modal-message",children:[a.jsx("strong",{children:v.addressName})," adresini silmek istediğinize emin misiniz?"]}),a.jsx("p",{className:"delete-modal-warning",children:"Bu işlem geri alınamaz."})]}),a.jsxs("div",{className:"delete-modal-footer",children:[a.jsx("button",{className:"btn-modal-cancel",onClick:A,children:"İptal"}),a.jsx("button",{className:"btn-modal-delete",onClick:async()=>{if(v.addressId)try{x(""),f({isOpen:!1,addressId:null,addressName:""});const e=await fetch(`${n}/user/addresses/${v.addressId}`,{method:"DELETE",headers:{Authorization:"Bearer "+r,"Content-Type":"application/json"}}),s=await e.json();e.ok&&(s.isSuccess||s.success)?(j("Adres silindi"),g(),setTimeout(()=>j(""),3e3)):x(s.message||"Adres silinemedi")}catch(e){x("Adres silinirken bir hata oluştu")}},children:"Evet, Sil"})]})]})})]}):null};export{l as default};
