import{a as e,u as s,f as i,d as a,r,j as t,L as n}from"./react-vendor-2SZXphvN.js";import{a as o}from"./context-DXDbei_0.js";import{S as c}from"./SEO-CLq8vwqd.js";import{L as d}from"./LazyImage-CYh-si_0.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./index-DRjqN31K.js";const l=()=>{const l=e(),m=s(),[h]=i(),{user:p,isAuthenticated:u,accessToken:x}=o(),[f,j]=a.useState(null),[N,y]=a.useState(!0),[g,I]=a.useState("");if(r.useEffect(()=>{let e=h.get("order");if(e||(e=new URLSearchParams(window.location.search).get("order")),e)e=e.trim(),(async e=>{try{if(y(!0),I(""),u&&p?.email&&x){const s=await fetch("https://api.yusufakin.com.tr/api/orders/query",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+x},body:JSON.stringify({orderNumber:e,customerEmail:p.email})});if(s.ok){const i=await s.json();if(i.isSuccess||i.success){const s=i.data||i,a={orderNumber:s.orderNumber||e,contactInfo:{firstName:s.customerName?.split(" ")[0]||"",lastName:s.customerName?.split(" ").slice(1).join(" ")||"",email:s.customerEmail||p.email||"",phone:s.customerPhone||""},addressInfo:s.addresses&&s.addresses.length>0?{address:s.addresses[0].addressLine||"",city:s.addresses[0].city||"",district:s.addresses[0].district||"",addressDetail:s.addresses[0].addressDetail||""}:{},cardInfo:{cardNumber:"CREDIT_CARD"===s.paymentMethod?"****":""},items:s.orderItems?s.orderItems.map(e=>({id:e.productId,name:e.productName||"Ürün",price:e.price||0,quantity:e.quantity||1,image:e.productImage||null,customizations:{en:e.width||0,boy:e.height||0,pileSikligi:e.pleatType||"pilesiz",calculatedPrice:e.price||0}})):[],totalPrice:s.totalAmount||s.totalPrice||0,orderDate:s.orderDate||(new Date).toISOString(),status:s.status||"PENDING"};return j(a),void y(!1)}}}let i=l.state?.orderData||null;if(!i)try{const e=sessionStorage.getItem("lastOrderData");e&&(i=JSON.parse(e),sessionStorage.removeItem("lastOrderData"))}catch(s){}if(!i&&e)try{const s=sessionStorage.getItem("checkoutData");if(s){const a=JSON.parse(s);i={orderNumber:e,contactInfo:a.contactInfo||{},addressInfo:a.addressInfo||{},cardInfo:a.cardInfo||{},items:a.items||[],totalPrice:a.totalPrice||0,orderDate:(new Date).toISOString()},sessionStorage.removeItem("checkoutData")}else i={orderNumber:e,contactInfo:{},addressInfo:{},cardInfo:{},items:[],totalPrice:0,orderDate:(new Date).toISOString()}}catch(s){i={orderNumber:e,contactInfo:{},addressInfo:{},cardInfo:{},items:[],totalPrice:0,orderDate:(new Date).toISOString()}}i?(j(i),y(!1)):(I("Sipariş bilgileri bulunamadı"),y(!1))}catch(i){I("Sipariş detayları yüklenirken bir hata oluştu"),y(!1)}})(e);else{let e=l.state?.orderData||null;if(!e)try{const s=sessionStorage.getItem("lastOrderData");s&&(e=JSON.parse(s),sessionStorage.removeItem("lastOrderData"))}catch(s){}e?(j(e),y(!1)):m("/",{replace:!0})}},[h,l,m,u,p,x]),N)return t.jsxs("div",{className:"order-confirmation-container",style:{padding:"3rem",textAlign:"center"},children:[t.jsxs("div",{className:"loading-spinner",style:{margin:"2rem auto"},children:[t.jsx("div",{className:"spinner",style:{border:"4px solid #f3f3f3",borderTop:"4px solid #667eea",borderRadius:"50%",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto"}}),t.jsx("style",{children:"\n            @keyframes spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n            }\n          "})]}),t.jsx("p",{children:"Yükleniyor..."})]});if(g||!f)return t.jsxs("div",{className:"order-confirmation-container",style:{padding:"3rem",textAlign:"center"},children:[t.jsx("div",{className:"error-icon",style:{color:"#e74c3c",marginBottom:"1rem"},children:t.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),t.jsx("h2",{children:"Sipariş Bulunamadı"}),t.jsx("p",{children:g||"Sipariş bilgileri yüklenemedi."}),t.jsx(n,{to:"/",className:"btn-primary",style:{marginTop:"1rem",display:"inline-block"},children:"Ana Sayfaya Dön"})]});const S=f.orderNumber||"ORD-"+Date.now(),v=(f.orderDate?new Date(f.orderDate):new Date).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),D={"@context":"https://schema.org","@type":"Order",orderNumber:S,orderDate:(new Date).toISOString(),customer:{"@type":"Person",name:`${f.contactInfo.firstName} ${f.contactInfo.lastName}`,email:f.contactInfo.email,telephone:f.contactInfo.phone},totalPrice:f.totalPrice};return t.jsxs("div",{className:"order-confirmation-container",children:[t.jsx(c,{title:"Sipariş Onayı",description:"Siparişiniz başarıyla alındı. Sipariş numaranız ve detayları.",keywords:"sipariş onayı, sipariş numarası, perde sipariş, sipariş teşekkür",url:"/siparis-onayi",structuredData:D}),t.jsxs("div",{className:"confirmation-content",children:[t.jsx("div",{className:"success-icon",children:t.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),t.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),t.jsxs("header",{className:"confirmation-header",children:[t.jsx("h1",{children:"Siparişiniz Alındı!"}),t.jsx("p",{className:"confirmation-subtitle",children:"Siparişiniz için teşekkür ederiz"})]}),t.jsxs("div",{className:"order-details-card",children:[t.jsxs("div",{className:"order-number-section",children:[t.jsx("h2",{children:"Sipariş Numarası"}),t.jsx("p",{className:"order-number",children:S}),t.jsxs("p",{className:"order-date",children:["Sipariş Tarihi: ",v]})]}),t.jsxs("div",{className:"order-info-grid",children:[(f.contactInfo.firstName||f.contactInfo.email||f.contactInfo.phone)&&t.jsxs("div",{className:"info-section",children:[t.jsx("h3",{children:"Fatura Bilgileri"}),t.jsxs("div",{className:"info-content",children:[(f.contactInfo.firstName||f.contactInfo.lastName)&&t.jsxs("p",{children:[t.jsx("strong",{children:"Ad Soyad:"})," ",f.contactInfo.firstName||""," ",f.contactInfo.lastName||""]}),f.contactInfo.email&&t.jsxs("p",{children:[t.jsx("strong",{children:"E-posta:"})," ",f.contactInfo.email]}),f.contactInfo.phone&&t.jsxs("p",{children:[t.jsx("strong",{children:"Telefon:"})," ",f.contactInfo.phone]})]})]}),(f.addressInfo.address||f.addressInfo.city)&&t.jsxs("div",{className:"info-section",children:[t.jsx("h3",{children:"Teslimat Adresi"}),t.jsxs("div",{className:"info-content",children:[f.addressInfo.address&&t.jsx("p",{children:f.addressInfo.address}),(f.addressInfo.district||f.addressInfo.city)&&t.jsxs("p",{children:[f.addressInfo.district||"",f.addressInfo.district&&f.addressInfo.city?", ":"",f.addressInfo.city||""]}),f.addressInfo.addressDetail&&t.jsxs("p",{children:[t.jsx("strong",{children:"Adres Detayı:"})," ",f.addressInfo.addressDetail]})]})]}),(f.cardInfo.cardNumber||f.totalPrice>0)&&t.jsxs("div",{className:"info-section",children:[t.jsx("h3",{children:"Ödeme Bilgileri"}),t.jsxs("div",{className:"info-content",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Ödeme Yöntemi:"})," Kredi Kartı"]}),f.cardInfo.cardNumber&&f.cardInfo.cardNumber.length>=4&&t.jsxs("p",{children:[t.jsx("strong",{children:"Kart:"})," •••• •••• •••• ",f.cardInfo.cardNumber.slice(-4)]}),f.totalPrice>0&&t.jsxs("p",{children:[t.jsx("strong",{children:"Toplam Tutar:"})," ",f.totalPrice.toFixed(2)," ₺"]})]})]}),f.items&&f.items.length>0&&t.jsxs("div",{className:"info-section full-width",children:[t.jsx("h3",{children:"Sipariş Detayları"}),t.jsx("div",{className:"order-items-list",children:f.items.map((e,s)=>t.jsxs("div",{className:"confirmation-item",children:[e.image&&t.jsx("div",{className:"item-image",children:t.jsx(d,{src:e.image,alt:e.name,className:"product-image"})}),t.jsxs("div",{className:"item-info",children:[t.jsx("span",{className:"item-name",children:e.name}),e.customizations&&t.jsxs("div",{className:"item-customizations",children:[e.customizations.en&&t.jsxs("span",{children:["En: ",e.customizations.en," cm"]}),e.customizations.boy&&t.jsxs("span",{children:["Boy: ",e.customizations.boy," cm"]}),e.customizations.pileSikligi&&t.jsxs("span",{children:["Pile: ","pilesiz"===e.customizations.pileSikligi?"Pilesiz":e.customizations.pileSikligi]})]}),t.jsxs("span",{className:"item-quantity",children:["Adet: ",e.quantity]})]}),t.jsxs("div",{className:"item-price",children:[((e.customizations?.calculatedPrice||e.price||0)*(e.quantity||1)).toFixed(2)," ₺"]})]},s))}),f.totalPrice>0&&t.jsxs("div",{className:"order-summary",children:[t.jsxs("div",{className:"summary-row",children:[t.jsx("span",{children:"Ara Toplam:"}),t.jsxs("span",{children:[f.totalPrice.toFixed(2)," ₺"]})]}),t.jsxs("div",{className:"summary-row",children:[t.jsx("span",{children:"Kargo:"}),t.jsx("span",{className:"free-shipping",children:"Ücretsiz"})]}),t.jsxs("div",{className:"summary-row total",children:[t.jsx("span",{children:"Toplam:"}),t.jsxs("span",{children:[f.totalPrice.toFixed(2)," ₺"]})]})]})]})]})]}),t.jsxs("div",{className:"confirmation-actions",children:[t.jsxs("p",{className:"info-text",children:["Sipariş durumunuzu ",t.jsx(n,{to:"/siparis-sorgula",children:"Sipariş Sorgula"})," sayfasından takip edebilirsiniz."]}),t.jsx("div",{className:"action-buttons",children:t.jsx(n,{to:"/",className:"btn-primary",children:"Ana Sayfaya Dön"})})]})]})]})};export{l as default};
