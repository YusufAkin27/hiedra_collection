import{e,u as r,r as s,j as i,L as t}from"./react-vendor-2SZXphvN.js";import{a}from"./context-DXDbei_0.js";import{S as n}from"./SEO-CLq8vwqd.js";import{L as d}from"./LazyImage-CYh-si_0.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./index-DRjqN31K.js";const l="https://api.yusufakin.com.tr/api",o=()=>{const{orderNumber:o}=e(),{user:c,isAuthenticated:m,accessToken:u,logout:h}=a(),p=r(),[g,x]=s.useState(null),[f,y]=s.useState(!0),[b,j]=s.useState(""),[v,N]=s.useState(!1),[k,w]=s.useState("Ä°ade talebi"),[E,S]=s.useState(!1),[D,T]=s.useState(""),[I,z]=s.useState(null),[L,C]=s.useState(!1),[A,R]=s.useState(null),[P,B]=s.useState(0),[F,U]=s.useState(""),[M,O]=s.useState([]),[$,_]=s.useState([]),[q,W]=s.useState(!1),[K,Y]=s.useState({}),[H,G]=s.useState(!1),[V,Q]=s.useState(!1),[J,X]=s.useState(!1),[Z,ee]=s.useState(!1),[re,se]=s.useState({fullName:"",phone:"",addressLine:"",addressDetail:"",city:"",district:""}),[ie,te]=s.useState({customerName:"",customerPhone:""});s.useEffect(()=>{m?o&&ae():p("/giris")},[o,m,u]);const ae=async()=>{if(!c?.email||!o)return j("KullanÄ±cÄ± bilgisi veya sipariÅŸ numarasÄ± bulunamadÄ±"),void y(!1);if(!u||!m)return j("SipariÅŸ detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in giriÅŸ yapmanÄ±z gerekiyor."),y(!1),void setTimeout(()=>{p("/giris",{state:{returnTo:"/siparis/"+o}})},1500);try{y(!0),j(""),T("");const e=await fetch(l+"/orders/query",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+u},body:JSON.stringify({orderNumber:o,customerEmail:c.email})});if(!e.ok){if(401===e.status)return h(),j("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n."),void setTimeout(()=>{p("/giris",{state:{returnTo:"/siparis/"+o}})},1500);if(404===e.status)throw Error("SipariÅŸ bulunamadÄ±.");{const r=await e.json().catch(()=>({}));throw Error(r.message||`SipariÅŸ yÃ¼klenemedi (${e.status})`)}}const r=await e.json();if(!r.isSuccess&&!r.success)throw Error(r.message||"SipariÅŸ yÃ¼klenemedi");{const e=r.data||r,s={...e,shippingAddress:e.addresses&&e.addresses.length>0?e.addresses[0]:{}};x(s);const i=s.shippingAddress||{};se({fullName:i.fullName||s.customerName||"",phone:i.phone||s.customerPhone||"",addressLine:i.addressLine||"",addressDetail:i.addressDetail||"",city:i.city||"",district:i.district||""}),te({customerName:s.customerName||"",customerPhone:s.customerPhone||""}),e.trackingNumber&&ne(e.trackingNumber,e.orderNumber),"DELIVERED"!==e.status&&"TESLIM_EDILDI"!==e.status||!e.orderItems||le(e.orderItems)}}catch(e){j(e.message||"SipariÅŸ yÃ¼klenirken bir hata oluÅŸtu")}finally{y(!1)}},ne=async(e,r)=>{if(e&&c?.email)try{C(!0);const e=new URL(l+"/shipping/track-by-order");e.searchParams.append("orderNumber",r),e.searchParams.append("email",c.email);const s=await fetch(e.toString(),{method:"GET",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}}}),i=await s.json();(i.isSuccess||i.success)&&z(i.data)}catch(s){}finally{C(!1)}},de=e=>{if(!e)return"";try{return new Date(e).toLocaleString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}},le=async e=>{if(!e||!e.length||!u)return void Y({});const r={},s=new Set;for(const t of e)t.productId&&s.add(t.productId);const i=Array.from(s).map(async e=>{try{const r=await fetch(`${l}/reviews/product/${e}/has-reviewed`,{headers:{Authorization:"Bearer "+u}});if(r.ok){const s=await r.json();if(s.isSuccess&&!0===s.data)return{productId:e,hasReviewed:!0}}}catch(r){}return{productId:e,hasReviewed:!1}});(await Promise.all(i)).forEach(({productId:e,hasReviewed:s})=>{s&&(r[e]=!0)}),Y(r)},oe=()=>{R(null),B(0),U(""),O([]),_([])},ce=()=>{if(!g||!g.status)return!1;const e=g.status.toUpperCase();return"SHIPPED"!==e&&"KARGOYA_VERILDI"!==e&&"DELIVERED"!==e&&"TESLIM_EDILDI"!==e&&"CANCELLED"!==e&&"IPTAL_EDILDI"!==e},me=e=>{se({...re,[e.target.name]:e.target.value})},ue=e=>{te({...ie,[e.target.name]:e.target.value})};return m?i.jsxs("div",{className:"order-detail-container",children:[i.jsx(n,{title:`SipariÅŸ DetayÄ± - ${o} - Hiedra Perde`,description:o+" numaralÄ± sipariÅŸinizin detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin",url:"/siparis/"+o}),f?i.jsxs("div",{className:"loading-state",children:[i.jsx("div",{className:"loading-spinner"}),i.jsx("p",{children:"SipariÅŸ yÃ¼kleniyor..."})]}):b&&!g?i.jsxs("div",{className:"error-state",children:[i.jsx("p",{children:b}),i.jsxs("div",{className:"action-buttons",children:[i.jsx("button",{onClick:ae,className:"retry-btn",children:"Tekrar Dene"}),i.jsx(t,{to:"/siparislerim",className:"back-btn",children:"SipariÅŸlerime DÃ¶n"})]})]}):g?i.jsxs(i.Fragment,{children:[i.jsx("header",{className:"order-detail-header",children:i.jsxs("div",{className:"header-content",children:[i.jsx(t,{to:"/siparislerim",className:"back-link",children:"â† SipariÅŸlerime DÃ¶n"}),i.jsx("h1",{children:"SipariÅŸ DetayÄ±"})]})}),b&&i.jsx("div",{className:"error-message",children:b}),D&&i.jsx("div",{className:"success-message",children:D}),i.jsxs("div",{className:"order-detail-content",children:[i.jsx("div",{className:"order-summary-card",children:i.jsxs("div",{className:"summary-header",children:[i.jsxs("div",{className:"order-info",children:[i.jsxs("h2",{children:["SipariÅŸ No: ",g.orderNumber]}),i.jsx("span",{className:"status-badge "+(e=>{if(!e)return"status-unknown";const r=e.toUpperCase();return"DELIVERED"===r||"TESLIM_EDILDI"===r?"status-delivered":"SHIPPED"===r||"KARGOYA_VERILDI"===r?"status-shipped":"PROCESSING"===r||"PAID"===r||"ISLEME_ALINDI"===r||"ODENDI"===r?"status-processing":"CANCELLED"===r||"REFUNDED"===r||"IPTAL_EDILDI"===r||"IADE_YAPILDI"===r?"status-cancelled":"REFUND_REQUESTED"===r||"IADE_TALEP_EDILDI"===r?"status-refund":"status-pending"})(g.status),children:(he=g.status,he?{PENDING:"Beklemede",PAID:"Ã–dendi",PROCESSING:"HazÄ±rlanÄ±yor",SHIPPED:"Kargoya Verildi",DELIVERED:"Teslim Edildi",TESLIM_EDILDI:"Teslim Edildi",CANCELLED:"Ä°ptal Edildi",REFUNDED:"Ä°ade Edildi",REFUND_REQUESTED:"Ä°ade Talebi"}[he.toUpperCase()]||he:"Bilinmiyor")})]}),i.jsxs("div",{className:"order-date",children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("polyline",{points:"12 6 12 12 16 14"})]}),g.createdAt?new Date(g.createdAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Tarih bilgisi yok"]})]})}),i.jsxs("div",{className:"order-section",children:[i.jsx("h3",{children:"SipariÅŸ ÃœrÃ¼nleri"}),i.jsx("div",{className:"order-items-list",children:g.orderItems&&g.orderItems.length>0?g.orderItems.map((e,r)=>{const s=e.productImageUrl||"/images/perde1kapak.jpg",t=("DELIVERED"===g.status||"TESLIM_EDILDI"===g.status)&&e.productId,a=K[e.productId];return i.jsxs("div",{className:"order-item-detail",children:[i.jsx("div",{className:"order-item-image-wrapper-detail",children:i.jsx(d,{src:s,alt:e.productName||"ÃœrÃ¼n",className:"order-item-image-detail"})}),i.jsxs("div",{className:"item-main-info",children:[i.jsx("h4",{children:e.productName||"ÃœrÃ¼n"}),i.jsxs("div",{className:"item-specs",children:[e.width&&e.height&&i.jsxs("span",{className:"spec-item",children:[i.jsx("strong",{children:"Ã–lÃ§Ã¼ler:"})," ",e.width," x ",e.height," cm"]}),e.pleatType&&"1x1"!==e.pleatType&&i.jsxs("span",{className:"spec-item",children:[i.jsx("strong",{children:"Pile Tipi:"})," ",e.pleatType]}),i.jsxs("span",{className:"spec-item",children:[i.jsx("strong",{children:"Adet:"})," ",e.quantity||1]})]}),t&&!a&&i.jsx("button",{onClick:()=>((e,r,s)=>{K[e]?j("Bu Ã¼rÃ¼ne zaten yorum yaptÄ±nÄ±z. Her Ã¼rÃ¼ne sadece bir kez yorum yapabilirsiniz."):(R({productId:e,productName:r,productImage:s}),B(0),U(""),O([]),_([]),j(""))})(e.productId,e.productName,s),className:"review-btn",style:{marginTop:"0.75rem",padding:"0.5rem 1rem",background:"#667eea",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",transition:"all 0.2s"},title:"Bu Ã¼rÃ¼ne yorum yap",children:"Yorum Yap"})]})]},e.id||r)}):i.jsx("p",{children:"SipariÅŸ detayÄ± bulunamadÄ±"})})]}),i.jsxs("div",{className:"order-section",children:[i.jsxs("div",{className:"section-header-with-action",children:[i.jsx("h3",{children:"Teslimat Adresi"}),ce()&&!H&&i.jsxs("button",{onClick:()=>G(!0),className:"edit-btn",type:"button",children:[i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),i.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"DÃ¼zenle"]})]}),H?i.jsxs("div",{className:"address-form-container",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address-fullName",children:["Ad Soyad ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"address-fullName",type:"text",name:"fullName",value:re.fullName,onChange:me,required:!0,className:"form-input"})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address-phone",children:["Telefon ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"address-phone",type:"text",name:"phone",value:re.phone,onChange:me,required:!0,className:"form-input",placeholder:"Ã–rn: +905551234567"})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address-line",children:["Adres SatÄ±rÄ± ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"address-line",type:"text",name:"addressLine",value:re.addressLine,onChange:me,required:!0,className:"form-input"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"address-detail",children:"Adres DetayÄ±"}),i.jsx("input",{id:"address-detail",type:"text",name:"addressDetail",value:re.addressDetail,onChange:me,className:"form-input",placeholder:"Daire, Kat, Bina No vb."})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address-district",children:["Ä°lÃ§e ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"address-district",type:"text",name:"district",value:re.district,onChange:me,required:!0,className:"form-input"})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"address-city",children:["Åehir ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"address-city",type:"text",name:"city",value:re.city,onChange:me,required:!0,className:"form-input"})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{onClick:()=>{G(!1);const e=g.shippingAddress||{};se({fullName:e.fullName||g.customerName||"",phone:e.phone||g.customerPhone||"",addressLine:e.addressLine||"",addressDetail:e.addressDetail||"",city:e.city||"",district:e.district||""})},className:"cancel-btn",type:"button",disabled:J,children:"Ä°ptal"}),i.jsx("button",{onClick:async()=>{if(re.fullName&&re.phone&&re.addressLine&&re.city&&re.district){X(!0),j(""),T("");try{const e=await fetch(`${l}/orders/${o}/address?email=${encodeURIComponent(c.email)}`,{method:"PUT",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}},body:JSON.stringify({orderNumber:o,fullName:re.fullName,phone:re.phone,addressLine:re.addressLine,addressDetail:re.addressDetail||"",city:re.city,district:re.district})});if(!e.ok){if(401===e.status)return h(),j("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n."),void setTimeout(()=>{p("/giris",{state:{returnTo:"/siparis/"+o}})},1500);const r=await e.json().catch(()=>({}));throw Error(r.message||"Adres gÃ¼ncellenemedi")}const r=await e.json();if(!r.success&&!r.isSuccess)throw Error(r.message||"Adres gÃ¼ncellenemedi");T("Adres baÅŸarÄ±yla gÃ¼ncellendi!"),G(!1),await ae()}catch(e){j(e.message||"Adres gÃ¼ncellenirken bir hata oluÅŸtu")}finally{X(!1)}}else j("LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurunuz.")},className:"save-btn",type:"button",disabled:J,children:J?"Kaydediliyor...":"Kaydet"})]})]}):i.jsxs("div",{className:"address-details",children:[g.shippingAddress&&i.jsxs(i.Fragment,{children:[(g.shippingAddress.fullName||g.customerName)&&i.jsxs("p",{children:[i.jsx("strong",{children:"Ad Soyad:"})," ",g.shippingAddress.fullName||g.customerName]}),(g.shippingAddress.phone||g.customerPhone)&&i.jsxs("p",{children:[i.jsx("strong",{children:"Telefon:"})," ",g.shippingAddress.phone||g.customerPhone]}),g.shippingAddress.addressLine&&i.jsxs("p",{children:[i.jsx("strong",{children:"Adres:"})," ",g.shippingAddress.addressLine]}),g.shippingAddress.addressDetail&&i.jsxs("p",{children:[i.jsx("strong",{children:"Adres DetayÄ±:"})," ",g.shippingAddress.addressDetail]}),(g.shippingAddress.district||g.shippingAddress.city)&&i.jsxs("p",{children:[i.jsx("strong",{children:"Ä°lÃ§e/Åehir:"})," ",g.shippingAddress.district||"",g.shippingAddress.district&&g.shippingAddress.city?" / ":"",g.shippingAddress.city||""]})]}),(!g.shippingAddress||!g.shippingAddress.addressLine&&!g.shippingAddress.city)&&i.jsx("p",{children:"Adres bilgisi bulunamadÄ±"})]})]}),g.trackingNumber&&i.jsxs("div",{className:"order-section tracking-section",children:[i.jsx("h3",{children:"Kargo Takip Bilgileri"}),i.jsxs("div",{className:"tracking-info-card",children:[i.jsxs("div",{className:"tracking-header-info",children:[i.jsxs("div",{className:"tracking-number-info",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Takip NumarasÄ±:"})," ",g.trackingNumber]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Kargo FirmasÄ±:"})," ",g.carrier||"DHL"]}),g.shippedAt&&i.jsxs("p",{children:[i.jsx("strong",{children:"Kargoya Verilme:"})," ",new Date(g.shippedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i.jsx("button",{onClick:()=>ne(g.trackingNumber,g.orderNumber),disabled:L,style:{padding:"0.5rem 1rem",background:L?"#ccc":"#667eea",color:"white",border:"none",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.9rem",opacity:L?.6:1},children:L?"YÃ¼kleniyor...":"ğŸ”„ GÃ¼ncelle"}),i.jsx(t,{to:`/kargo-takip?trackingNumber=${g.trackingNumber}&orderNumber=${g.orderNumber}`,className:"track-shipment-link",children:"ğŸ“¦ DetaylÄ± Takip"})]})]}),L?i.jsx("div",{className:"tracking-loading",children:i.jsx("p",{children:"Kargo bilgileri yÃ¼kleniyor..."})}):I?i.jsxs("div",{className:"tracking-details",children:[i.jsxs("div",{className:"tracking-status-badge",children:[i.jsx("div",{className:"status-badge "+(e=>{if(!e)return"tracking-status-unknown";const r=e.toUpperCase();return"DELIVERED"===r?"tracking-status-delivered":"IN_TRANSIT"===r||"OUT_FOR_DELIVERY"===r?"tracking-status-transit":"EXCEPTION"===r?"tracking-status-exception":"tracking-status-pending"})(I.status),children:(e=>e?{IN_TRANSIT:"Kargoda",DELIVERED:"Teslim Edildi",EXCEPTION:"Sorun Var",PENDING:"Beklemede",PICKED_UP:"Kargo AlÄ±ndÄ±",OUT_FOR_DELIVERY:"Teslimat Ä°Ã§in Yola Ã‡Ä±ktÄ±"}[e]||e:"Bilinmiyor")(I.status)}),I.statusDescription&&i.jsx("p",{className:"status-description",children:I.statusDescription})]}),I.events&&I.events.length>0&&i.jsxs("div",{className:"tracking-events-preview",children:[i.jsx("h4",{children:"Son Hareketler"}),i.jsxs("div",{className:"events-list",children:[I.events.slice(0,3).map((e,r)=>i.jsxs("div",{className:"event-preview-item",children:[i.jsx("div",{className:"event-time-small",children:de(e.timestamp)}),i.jsxs("div",{className:"event-content-small",children:[e.location&&i.jsx("span",{className:"location-icon",children:"ğŸ“"}),i.jsx("span",{children:e.location||"Konum bilgisi yok"})]}),e.description&&i.jsx("div",{className:"event-description-small",children:e.description})]},r)),I.events.length>3&&i.jsxs(t,{to:`/kargo-takip?trackingNumber=${g.trackingNumber}&orderNumber=${g.orderNumber}`,className:"view-all-events-link",children:["TÃ¼m hareketleri gÃ¶rÃ¼ntÃ¼le (",I.events.length," adet)"]})]})]})]}):i.jsxs("div",{className:"tracking-no-data",children:[i.jsx("p",{children:'Kargo takip bilgisi henÃ¼z gÃ¼ncellenmedi. "GÃ¼ncelle" butonuna tÄ±klayarak en gÃ¼ncel bilgileri alabilirsiniz.'}),i.jsx("button",{onClick:()=>ne(g.trackingNumber,g.orderNumber),disabled:L,style:{marginTop:"0.5rem",padding:"0.5rem 1rem",background:L?"#ccc":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:L?"not-allowed":"pointer",fontSize:"0.9rem",opacity:L?.6:1},children:L?"YÃ¼kleniyor...":"Kargo Bilgisini YÃ¼kle"})]})]})]}),i.jsxs("div",{className:"order-section",children:[i.jsxs("div",{className:"section-header-with-action",children:[i.jsx("h3",{children:"MÃ¼ÅŸteri Bilgileri"}),ce()&&!V&&i.jsxs("button",{onClick:()=>Q(!0),className:"edit-btn",type:"button",children:[i.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),i.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"DÃ¼zenle"]})]}),V?i.jsxs("div",{className:"customer-form-container",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"customer-name",children:["Ad Soyad ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"customer-name",type:"text",name:"customerName",value:ie.customerName,onChange:ue,required:!0,className:"form-input"})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"customer-phone",children:["Telefon ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("input",{id:"customer-phone",type:"text",name:"customerPhone",value:ie.customerPhone,onChange:ue,required:!0,className:"form-input",placeholder:"Ã–rn: +905551234567"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"customer-email",children:"E-posta"}),i.jsx("input",{id:"customer-email",type:"email",value:g.customerEmail||"",disabled:!0,className:"form-input disabled"}),i.jsx("small",{className:"form-hint",children:"E-posta adresi deÄŸiÅŸtirilemez"})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{onClick:()=>{Q(!1),te({customerName:g.customerName||"",customerPhone:g.customerPhone||""})},className:"cancel-btn",type:"button",disabled:J,children:"Ä°ptal"}),i.jsx("button",{onClick:async()=>{if(ie.customerName&&ie.customerPhone){X(!0),j("");try{const e=await fetch(`${l}/orders/${o}/address?email=${encodeURIComponent(c.email)}`,{method:"PUT",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}},body:JSON.stringify({orderNumber:o,fullName:ie.customerName,phone:ie.customerPhone,addressLine:re.addressLine||g.shippingAddress?.addressLine||"",addressDetail:re.addressDetail||g.shippingAddress?.addressDetail||"",city:re.city||g.shippingAddress?.city||"",district:re.district||g.shippingAddress?.district||""})});if(!e.ok){const r=await e.json().catch(()=>({}));throw Error(r.message||"Bilgiler gÃ¼ncellenemedi")}{const r=await e.json();if(!r.success&&!r.isSuccess)throw Error(r.message||"Bilgiler gÃ¼ncellenemedi");T("Bilgiler baÅŸarÄ±yla gÃ¼ncellendi!"),Q(!1),await ae()}}catch(e){j(e.message||"Bilgiler gÃ¼ncellenirken bir hata oluÅŸtu")}finally{X(!1)}}else j("LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurunuz.")},className:"save-btn",type:"button",disabled:J,children:J?"Kaydediliyor...":"Kaydet"})]})]}):i.jsxs("div",{className:"customer-details",children:[g.customerName&&i.jsxs("p",{children:[i.jsx("strong",{children:"Ad Soyad:"})," ",g.customerName]}),g.customerEmail&&i.jsxs("p",{children:[i.jsx("strong",{children:"E-posta:"})," ",g.customerEmail]}),g.customerPhone&&i.jsxs("p",{children:[i.jsx("strong",{children:"Telefon:"})," ",g.customerPhone]})]})]}),i.jsxs("div",{className:"order-section invoice-section",children:[i.jsx("h3",{children:"Fatura Ä°ÅŸlemleri"}),i.jsxs("div",{className:"invoice-actions-container",children:[i.jsx("p",{className:"invoice-description",children:"SipariÅŸinizin faturasÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyebilir, indirebilir veya e-posta adresinize gÃ¶nderebilirsiniz."}),i.jsxs("div",{className:"invoice-buttons",children:[i.jsxs("button",{onClick:async()=>{try{const e=await fetch(`${l}/invoices/order/${o}/view`,{headers:{...u&&{Authorization:"Bearer "+u}}});if(!e.ok){if(404===e.status)return void j("Bu sipariÅŸ iÃ§in henÃ¼z fatura oluÅŸturulmamÄ±ÅŸ.");throw Error("Fatura gÃ¶rÃ¼ntÃ¼lenemedi")}const r=await e.blob(),s=window.URL.createObjectURL(r);window.open(s,"_blank")}catch(e){j("Fatura gÃ¶rÃ¼ntÃ¼lenirken bir hata oluÅŸtu.")}},className:"invoice-btn invoice-btn-view",type:"button",children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),i.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),i.jsx("span",{children:"FaturayÄ± GÃ¶rÃ¼ntÃ¼le"})]}),i.jsxs("button",{onClick:async()=>{try{const e=await fetch(`${l}/invoices/order/${o}/download`,{headers:{...u&&{Authorization:"Bearer "+u}}});if(!e.ok){if(404===e.status)return void j("Bu sipariÅŸ iÃ§in henÃ¼z fatura oluÅŸturulmamÄ±ÅŸ.");throw Error("Fatura indirilemedi")}const r=await e.blob(),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`fatura-${o}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}catch(e){j("Fatura indirilirken bir hata oluÅŸtu.")}},className:"invoice-btn invoice-btn-download",type:"button",children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),i.jsx("polyline",{points:"7 10 12 15 17 10"}),i.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),i.jsx("span",{children:"FaturayÄ± Ä°ndir"})]}),i.jsx("button",{onClick:async()=>{ee(!0),j(""),T("");try{const e=await fetch(`${l}/invoices/order/${o}/send-email`,{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}}}),r=await e.json();if(!e.ok||!r.isSuccess&&!r.success)throw Error(r.message||"Fatura gÃ¶nderilemedi");T("Fatura e-posta adresinize gÃ¶nderildi!")}catch(e){j(e.message||"Fatura gÃ¶nderilirken bir hata oluÅŸtu.")}finally{ee(!1)}},disabled:Z,className:"invoice-btn invoice-btn-email",type:"button",children:Z?i.jsxs(i.Fragment,{children:[i.jsx("svg",{className:"spinner-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),i.jsx("span",{children:"GÃ¶nderiliyor..."})]}):i.jsxs(i.Fragment,{children:[i.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),i.jsx("polyline",{points:"22,6 12,13 2,6"})]}),i.jsx("span",{children:"E-posta GÃ¶nder"})]})})]})]})]}),g.cancelReason&&i.jsxs("div",{className:"order-section",children:[i.jsx("h3",{children:"Ä°ptal Bilgisi"}),i.jsxs("div",{className:"cancel-info",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Sebep:"})," ",g.cancelReason]}),g.cancelledAt&&i.jsxs("p",{children:[i.jsx("strong",{children:"Ä°ptal Tarihi:"})," ",new Date(g.cancelledAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),g.refundedAt&&i.jsxs("div",{className:"order-section",children:[i.jsx("h3",{children:"Ä°ade Bilgisi"}),i.jsx("div",{className:"refund-info",children:i.jsxs("p",{children:[i.jsx("strong",{children:"Ä°ade Tarihi:"})," ",new Date(g.refundedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})})]}),"REFUND_REQUESTED"===g.status&&i.jsxs("div",{className:"order-section info-section",children:[i.jsx("h3",{children:"Ä°ade Talebi"}),i.jsx("div",{className:"refund-request-info",children:i.jsx("p",{children:"Ä°ade talebiniz alÄ±nmÄ±ÅŸtÄ±r ve deÄŸerlendirme aÅŸamasÄ±ndadÄ±r. En kÄ±sa sÃ¼rede size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."})})]}),(()=>{if(!g||!g.status)return!1;const e=g.status.toUpperCase();return"REFUNDED"!==e&&"REFUND_REQUESTED"!==e})()&&i.jsx("div",{className:"refund-button-section",children:i.jsx("button",{onClick:()=>N(!0),className:"refund-request-btn",disabled:E,children:"Ä°ade Talebi"})})]}),A&&i.jsx("div",{className:"review-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"1rem",animation:"fadeIn 0.2s ease-out"},onClick:oe,children:i.jsxs("div",{className:"review-modal",style:{background:"white",borderRadius:"20px",padding:0,maxWidth:"650px",width:"100%",maxHeight:"90vh",overflow:"hidden",boxShadow:"0 25px 80px rgba(0, 0, 0, 0.4)",display:"flex",flexDirection:"column",animation:"slideUp 0.3s ease-out"},onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{style:{background:"#ffffff",padding:"1.5rem 2rem",borderBottom:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"600",color:"#1f2937"},children:"ÃœrÃ¼n Yorumu"}),i.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.875rem",color:"#6b7280"},children:"Deneyiminizi paylaÅŸÄ±n"})]}),i.jsx("button",{onClick:oe,style:{background:"#f3f4f6",border:"none",borderRadius:"50%",width:"32px",height:"32px",cursor:"pointer",color:"#6b7280",fontSize:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",lineHeight:1},onMouseEnter:e=>{e.currentTarget.style.background="#e5e7eb",e.currentTarget.style.color="#374151"},onMouseLeave:e=>{e.currentTarget.style.background="#f3f4f6",e.currentTarget.style.color="#6b7280"},children:"Ã—"})]}),i.jsxs("div",{style:{padding:"2rem",overflowY:"auto",flex:1},children:[i.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",padding:"1rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[i.jsx("img",{src:A.productImage,alt:A.productName,style:{width:"80px",height:"80px",objectFit:"cover",borderRadius:"8px",border:"1px solid #e5e7eb"}}),i.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600",color:"#1f2937",marginBottom:"0.25rem"},children:A.productName}),i.jsx("p",{style:{margin:0,fontSize:"0.8125rem",color:"#9ca3af"},children:"ÃœrÃ¼n hakkÄ±ndaki gÃ¶rÃ¼ÅŸleriniz bizim iÃ§in deÄŸerli"})]})]}),i.jsxs("div",{style:{marginBottom:"2rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"1rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:["PuanÄ±nÄ±z ",i.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-start",alignItems:"center",padding:"1rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[[1,2,3,4,5].map(e=>i.jsx("button",{type:"button",onClick:()=>B(e),style:{background:"none",border:"none",cursor:"pointer",padding:"0.25rem",transition:"transform 0.15s",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:i.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:e>P?"none":"#fbbf24",stroke:e>P?"#d1d5db":"#f59e0b",strokeWidth:"1.5",style:{transition:"all 0.2s"},children:i.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})},e)),P>0&&i.jsx("span",{style:{marginLeft:"1rem",fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},children:5===P?"MÃ¼kemmel":4===P?"Ã‡ok Ä°yi":3===P?"Ä°yi":2===P?"Orta":"KÃ¶tÃ¼"})]})]}),i.jsxs("div",{style:{marginBottom:"2rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.75rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:"Yorumunuz"}),i.jsx("textarea",{value:F,onChange:e=>U(e.target.value),rows:"6",style:{width:"100%",padding:"0.875rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",transition:"all 0.2s",lineHeight:"1.5",color:"#1f2937",background:"#ffffff"},onFocus:e=>e.currentTarget.style.borderColor="#9ca3af",onBlur:e=>e.currentTarget.style.borderColor="#d1d5db",placeholder:"ÃœrÃ¼n hakkÄ±ndaki dÃ¼ÅŸÃ¼ncelerinizi paylaÅŸÄ±n...",maxLength:2e3}),i.jsxs("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:F.length>1900?"#ef4444":"#9ca3af",textAlign:"right",fontWeight:F.length>1900?"600":"400"},children:[F.length,"/2000 karakter"]})]}),i.jsxs("div",{style:{marginBottom:"2rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.75rem",fontWeight:"600",fontSize:"0.9375rem",color:"#374151"},children:["FotoÄŸraflar ",i.jsx("span",{style:{fontWeight:"400",color:"#9ca3af",fontSize:"0.8125rem"},children:"(Opsiyonel, en fazla 5)"})]}),i.jsxs("div",{style:{border:"1px dashed #d1d5db",borderRadius:"8px",padding:"1rem",textAlign:"center",background:"#f9fafb",transition:"all 0.2s",marginBottom:"1rem"},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.borderColor="#9ca3af",e.currentTarget.style.background="#f3f4f6"},onDragLeave:e=>{e.currentTarget.style.borderColor="#d1d5db",e.currentTarget.style.background="#f9fafb"},children:[i.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const r=Array.from(e.target.files);if(r.length+M.length>5)return void j("En fazla 5 gÃ¶rsel yÃ¼kleyebilirsiniz");const s=[...M,...r];O(s);const i=[];r.forEach(e=>{const r=new FileReader;r.onload=e=>{i.push(e.target.result),i.length===s.length&&_(i)},r.readAsDataURL(e)})},disabled:M.length>=5,style:{width:"100%",padding:"0.625rem",border:"1px solid #d1d5db",borderRadius:"6px",background:5>M.length?"white":"#f3f4f6",cursor:5>M.length?"pointer":"not-allowed",fontSize:"0.8125rem",color:"#374151"}}),M.length>=5&&i.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.75rem",color:"#ef4444"},children:"Maksimum 5 fotoÄŸraf yÃ¼kleyebilirsiniz"})]}),$.length>0&&i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:"1rem"},children:$.map((e,r)=>i.jsxs("div",{style:{position:"relative",borderRadius:"8px",overflow:"hidden",border:"1px solid #e5e7eb",transition:"transform 0.2s"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.02)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:[i.jsx("img",{src:e,alt:"Preview "+(r+1),style:{width:"100%",height:"100px",objectFit:"cover",display:"block"}}),i.jsx("button",{type:"button",onClick:()=>(e=>{const r=M.filter((r,s)=>s!==e),s=$.filter((r,s)=>s!==e);O(r),_(s)})(r),style:{position:"absolute",top:"0.25rem",right:"0.25rem",background:"#ef4444",color:"white",border:"none",borderRadius:"50%",width:"24px",height:"24px",cursor:"pointer",fontSize:"0.875rem",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="#dc2626",onMouseLeave:e=>e.currentTarget.style.background="#ef4444",children:"Ã—"})]},r))})]}),i.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end",paddingTop:"1.5rem",borderTop:"1px solid #e5e7eb"},children:[i.jsx("button",{onClick:oe,disabled:q,style:{padding:"0.75rem 1.5rem",background:"#f3f4f6",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",fontWeight:"500",fontSize:"0.875rem",transition:"all 0.2s"},onMouseEnter:e=>!q&&(e.currentTarget.style.background="#e5e7eb"),onMouseLeave:e=>e.currentTarget.style.background="#f3f4f6",children:"Ä°ptal"}),i.jsx("button",{onClick:async()=>{if(A&&P&&P>=1&&5>=P)if(u){if(K[A.productId])return j("Bu Ã¼rÃ¼ne zaten yorum yaptÄ±nÄ±z. Her Ã¼rÃ¼ne sadece bir kez yorum yapabilirsiniz."),void oe();W(!0),j("");try{if(!u)return j("GiriÅŸ yapmanÄ±z gerekiyor. LÃ¼tfen sayfayÄ± yenileyip tekrar deneyin."),void W(!1);const e=new FormData;e.append("productId",A.productId.toString()),e.append("rating",P.toString()),F.trim()&&e.append("comment",F.trim()),M.forEach((r,s)=>{e.append("images",r)});const r={};u&&(r.Authorization="Bearer "+u);const s=await fetch(l+"/reviews",{method:"POST",headers:r,body:e});if(401===s.status)return h(),j("Oturum sÃ¼reniz dolmuÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n."),oe(),void setTimeout(()=>{p("/giris",{state:{returnTo:"/siparis/"+o}})},1500);const i=await s.json();if(!s.ok||!i.isSuccess&&!i.success){const e=i.message||"Yorum eklenirken bir hata oluÅŸtu";throw(e.includes("zaten yorum yaptÄ±nÄ±z")||e.includes("sadece bir kez"))&&Y(e=>({...e,[A.productId]:!0})),Error(e)}const t=i.message||"Yorumunuz gÃ¶nderildi. Yorumunuz kÄ±sa sÃ¼re iÃ§inde yayÄ±nlanacaktÄ±r.";T(t),Y(e=>({...e,[A.productId]:!0})),oe(),setTimeout(()=>{(async e=>{if(e&&u)try{const r=await fetch(`${l}/reviews/product/${e}/has-reviewed`,{headers:{Authorization:"Bearer "+u}});if(r.ok){const s=await r.json();s.isSuccess&&!0===s.data?Y(r=>({...r,[e]:!0})):Y(r=>{const s={...r};return delete s[e],s})}}catch(r){}})(A.productId)},1500),setTimeout(()=>{ae()},2e3)}catch(e){j(e.message||"Yorum eklenirken bir hata oluÅŸtu")}finally{W(!1)}}else j("GiriÅŸ yapmanÄ±z gerekiyor");else j("LÃ¼tfen 1-5 arasÄ± bir puan seÃ§in")},disabled:q||!P,style:{padding:"0.75rem 1.5rem",background:P?"#374151":"#d1d5db",color:"white",border:"none",borderRadius:"8px",cursor:P?"pointer":"not-allowed",fontWeight:"600",fontSize:"0.875rem",transition:"all 0.2s",opacity:q?.6:1},onMouseEnter:e=>{P&&!q&&(e.currentTarget.style.background="#1f2937")},onMouseLeave:e=>{e.currentTarget.style.background=P?"#374151":"#d1d5db"},children:q?i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),"GÃ¶nderiliyor..."]}):"Yorumu GÃ¶nder"})]})]})]})}),v&&i.jsx("div",{className:"modal-overlay",onClick:()=>!E&&N(!1),children:i.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[i.jsx("h3",{children:"Ä°ade Talebi OluÅŸtur"}),i.jsx("p",{children:"Ä°ade talebi oluÅŸturmak istediÄŸinizden emin misiniz? Ä°ade talebiniz deÄŸerlendirildikten sonra size geri dÃ¶nÃ¼ÅŸ yapÄ±lacaktÄ±r."}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"refundReason",children:["Ä°ade Sebebi ",i.jsx("span",{className:"required",children:"*"})]}),i.jsx("textarea",{id:"refundReason",value:k,onChange:e=>w(e.target.value),rows:"4",placeholder:"LÃ¼tfen iade sebebinizi detaylÄ± olarak aÃ§Ä±klayÄ±n...",required:!0})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{onClick:()=>{N(!1),w("Ä°ade talebi"),j("")},disabled:E,className:"cancel-btn",children:"Ä°ptal"}),i.jsx("button",{onClick:async()=>{if(k.trim()){S(!0),j(""),T("");try{const e=await fetch(`${l}/orders/${o}/refund?email=${encodeURIComponent(c.email)}&reason=${encodeURIComponent(k)}`,{method:"POST",headers:{"Content-Type":"application/json",...u&&{Authorization:"Bearer "+u}}}),r=await e.json();if(!e.ok)throw Error(r.message||"Ä°ade talebi oluÅŸturulamadÄ±");if(!r.isSuccess&&!r.success)throw Error(r.message||"Ä°ade talebi oluÅŸturulamadÄ±");T("Ä°ade talebiniz baÅŸarÄ±yla oluÅŸturuldu. En kÄ±sa sÃ¼rede deÄŸerlendirilecektir."),N(!1),w("Ä°ade talebi"),await ae()}catch(e){j(e.message||"Ä°ade talebi oluÅŸturulurken bir hata oluÅŸtu")}finally{S(!1)}}else j("LÃ¼tfen iade sebebini belirtin")},disabled:E||!k.trim(),className:"confirm-btn",children:E?"Ä°ÅŸleniyor...":"Ä°ade Talebi OluÅŸtur"})]})]})})]}):null]}):null;var he};export{o as default};
