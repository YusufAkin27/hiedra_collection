import{u as e,r,j as t}from"./react-vendor-2SZXphvN.js";import{a as s}from"./context-DXDbei_0.js";import{u as n}from"./index-DRjqN31K.js";import{S as a}from"./SEO-CLq8vwqd.js";/* empty css                   */import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";const i="https://api.yusufakin.com.tr/api",l=()=>{const l=e(),{accessToken:o,isAuthenticated:c}=s(),d=n(),[m,h]=r.useState([]),[u,p]=r.useState([]),[y,g]=r.useState(!0),[j,x]=r.useState("");r.useEffect(()=>{c?(async()=>{try{g(!0),x("");const[e,r]=await Promise.all([fetch(i+"/contracts",{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}}),fetch(i+"/contracts/my-history",{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}})]);if(!e.ok||!r.ok)return x("Sözleşmeler yüklenirken bir hata oluştu"),void g(!1);const t=await e.json(),s=await r.json();(t.isSuccess||t.success)&&h(t.data||[]),(s.isSuccess||s.success)&&p(s.data||[])}catch(e){x("Sözleşmeler yüklenirken bir hata oluştu")}finally{g(!1)}})():l("/giris")},[o,c,l]);const f=(e,r)=>{const t=u.find(t=>t.contract?.id===e&&t.acceptedVersion===r);return t?{status:"ACCEPTED"===t.status?"accepted":"rejected",acceptance:t}:{status:"pending",acceptance:null}};return y?t.jsx("div",{className:"legal-page",children:t.jsx("div",{className:"legal-container",children:t.jsx("div",{style:{textAlign:"center",padding:"3rem"},children:t.jsx("p",{children:"Yükleniyor..."})})})}):j?t.jsx("div",{className:"legal-page",children:t.jsx("div",{className:"legal-container",children:t.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[t.jsx("h1",{children:"Hata"}),t.jsx("p",{children:j}),t.jsx("button",{onClick:()=>l("/"),className:"btn btn-primary",style:{marginTop:"1rem"},children:"Ana Sayfaya Dön"})]})})}):t.jsxs(t.Fragment,{children:[t.jsx(a,{title:"Onayladığım Sözleşmeler - Hiedra Home",description:"Onayladığınız sözleşmeleri görüntüleyin"}),t.jsx("div",{className:"legal-page",children:t.jsxs("div",{className:"legal-container",children:[t.jsxs("div",{className:"legal-header",children:[t.jsx("h1",{children:"Onayladığım Sözleşmeler"}),t.jsx("p",{children:"Onayladığınız tüm sözleşmeleri buradan görüntüleyebilirsiniz"})]}),(()=>{const e=m.filter(e=>{const{status:r}=f(e.id,e.version);return"accepted"===r});return 0===e.length?t.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:t.jsx("p",{children:"Henüz onaylanmış sözleşme bulunmamaktadır."})}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:e.map(e=>{const{status:r,acceptance:s}=f(e.id,e.version);return t.jsxs("div",{style:{padding:"1.5rem",border:"1px solid var(--border-color)",borderRadius:"8px",backgroundColor:"rgba(16, 185, 129, 0.05)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("h2",{style:{margin:"0 0 0.5rem 0",color:"var(--text-primary)"},children:e.title}),e.type&&t.jsxs("p",{style:{margin:"0.25rem 0",color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Tür: ",e.type]}),e.version&&t.jsxs("p",{style:{margin:"0.25rem 0",color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Versiyon: ",e.version]}),s&&s.acceptedAt&&t.jsxs("p",{style:{margin:"0.25rem 0",color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Onay Tarihi: ",new Date(s.acceptedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),t.jsx("div",{style:{marginLeft:"1rem"},children:t.jsx("span",{style:{padding:"0.5rem 1rem",backgroundColor:"var(--success)",color:"white",borderRadius:"20px",fontSize:"0.85rem",fontWeight:"bold"},children:"✓ Onaylandı"})})]}),t.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.75rem"},children:[t.jsx("button",{className:"btn btn-primary",onClick:()=>l("/sozlesme/"+e.id),children:"Sözleşmeyi Görüntüle"}),(n=e.type,!["KULLANIM","GIZLILIK","KVKK","SATIS"].includes(n)&&t.jsx("button",{className:"btn btn-secondary",onClick:()=>(async(e,r)=>{if(window.confirm(`"${r}" sözleşmesini feshetmek istediğinize emin misiniz?`))try{const r=await fetch(`${i}/contracts/${e}/reject`,{method:"POST",headers:{Authorization:"Bearer "+o,"Content-Type":"application/json"}});if(!r.ok){const e=(await r.json().catch(()=>({}))).message||"Sözleşme feshedilemedi";return void d.error(e)}const t=await r.json();if(t.isSuccess||t.success)d.success("Sözleşme başarıyla feshedildi"),setTimeout(()=>{window.location.reload()},1e3);else{const e=t.message||"Sözleşme feshedilemedi";d.error(e)}}catch(t){d.error("Sözleşme feshedilirken bir hata oluştu")}})(e.id,e.title),style:{backgroundColor:"var(--danger)",color:"white"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#dc2626"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--danger)"},children:"Sözleşmeyi Feshet"}))]})]},e.id);var n})})})(),t.jsx("div",{className:"legal-footer",children:t.jsx("button",{onClick:()=>l("/profil"),className:"btn btn-secondary",children:"Profilime Dön"})})]})})]})};export{l as default};
