import{e,u as a,r as s,j as t}from"./react-vendor-2SZXphvN.js";import{S as n}from"./SEO-CLq8vwqd.js";/* empty css                   */import{u as l}from"./index-DRjqN31K.js";import"./vendor-invariant-BME_2b6A.js";import"./vendor-shallowequal-CcIhOdxx.js";import"./vendor-scheduler-BVKd3TJG.js";import"./vendor-@remix-run-BWfEV5os.js";import"./context-DXDbei_0.js";const c="https://api.yusufakin.com.tr/api",r=()=>{const{id:r}=e(),o=a(),i=l(),[d,m]=s.useState(null),[u,h]=s.useState(!0),[g,j]=s.useState(""),[p,y]=s.useState(!1),[x,S]=s.useState(!1);s.useEffect(()=>{r&&(async()=>{try{h(!0),j("");const e=await fetch(`${c}/contracts/${r}`);if(!e.ok)return 404===e.status?j("Sözleşme bulunamadı"):j("Sözleşme yüklenirken bir hata oluştu"),void h(!1);const a=await e.json();a.isSuccess||a.success?(m(a.data),v(a.data.id)):j(a.message||"Sözleşme yüklenemedi")}catch(e){j("Sözleşme yüklenirken bir hata oluştu")}finally{h(!1)}})()},[r]);const v=async e=>{try{const a=localStorage.getItem("guestUserId"),s=localStorage.getItem("accessToken"),t={"Content-Type":"application/json"};s&&(t.Authorization="Bearer "+s);const n=`${c}/contracts/${e}/status${a?"?guestUserId="+encodeURIComponent(a):""}`,l=await fetch(n,{headers:t});if(l.ok){const e=await l.json();(e.isSuccess||e.success)&&S(e.data?.accepted||!1)}}catch(a){}};return u?t.jsx("div",{className:"legal-page",children:t.jsx("div",{className:"legal-container",children:t.jsx("div",{className:"legal-loading",children:t.jsx("p",{children:"Yükleniyor..."})})})}):g||!d?t.jsx("div",{className:"legal-page",children:t.jsx("div",{className:"legal-container",children:t.jsxs("div",{className:"legal-error",children:[t.jsx("h1",{children:"Hata"}),t.jsx("p",{children:g||"Sözleşme bulunamadı"}),t.jsx("button",{onClick:()=>o("/"),className:"btn btn-primary",children:"Ana Sayfaya Dön"})]})})}):t.jsxs(t.Fragment,{children:[t.jsx(n,{title:d.title+" - Hiedra Home",description:d.content.substring(0,160)}),t.jsx("div",{className:"legal-page",children:t.jsxs("div",{className:"legal-container",children:[t.jsxs("div",{className:"legal-header",children:[t.jsx("h1",{children:d.title}),d.version&&t.jsxs("p",{className:"legal-version",children:["Versiyon: ",d.version]}),d.updatedAt&&t.jsxs("p",{className:"legal-date",children:["Son Güncelleme: ",new Date(d.updatedAt).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"})]})]}),t.jsx("div",{className:"legal-content",dangerouslySetInnerHTML:{__html:d.content}}),d.requiredApproval&&t.jsx("div",{className:"legal-actions",children:x?t.jsx("div",{className:"legal-accepted",children:t.jsx("p",{children:"✓ Bu sözleşmeyi onayladınız"})}):t.jsx("button",{onClick:async()=>{try{y(!0);const e=localStorage.getItem("guestUserId"),a=localStorage.getItem("accessToken"),s={"Content-Type":"application/json"};a&&(s.Authorization="Bearer "+a);const t=`${c}/contracts/${r}/accept${e?"?guestUserId="+encodeURIComponent(e):""}`,n=await fetch(t,{method:"POST",headers:s});if(n.ok){const e=await n.json();if(e.isSuccess||e.success)S(!0),i.success("Sözleşme başarıyla onaylandı!");else{const a=e.message||"Sözleşme onaylanamadı";i.error(a)}}else{const e=(await n.json().catch(()=>({}))).message||"Sözleşme onaylanamadı";i.error(e)}}catch(e){i.error("Sözleşme onaylanırken bir hata oluştu")}finally{y(!1)}},disabled:p,className:"btn btn-primary",children:p?"Onaylanıyor...":"Sözleşmeyi Onayla"})}),t.jsx("div",{className:"legal-footer",children:t.jsx("button",{onClick:()=>o(-1),className:"btn btn-secondary",children:"Geri Dön"})})]})})]})};export{r as default};
